<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REST API Reference ‚Äî Soulprint Docs</title>
<meta name="description" content="Full REST API reference for the Soulprint validator node ‚Äî endpoints, request/response schemas, error codes.">
<link rel="stylesheet" href="shared.css">
</head>
<body>
<div class="topbar">
  <a href="/" class="topbar-logo">üåÄ Soulprint</a>
  <div class="topbar-links"><a href="https://github.com/manuelariasfz/soulprint">GitHub</a><a href="/">Home</a></div>
</div>
<div class="docs-layout">
  <aside class="sidebar">
    <div class="sidebar-logo">
      <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="g" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#7c6cf5"/><stop offset="100%" stop-color="#a78bfa"/>
        </linearGradient></defs>
        <circle cx="32" cy="26" r="18" fill="url(#g)"/>
        <rect x="14" y="26" width="36" height="20" fill="url(#g)"/>
        <circle cx="19" cy="48" r="5.5" fill="url(#g)"/>
        <circle cx="32" cy="49" r="5.5" fill="url(#g)"/>
        <circle cx="45" cy="48" r="5.5" fill="url(#g)"/>
        <ellipse cx="25" cy="25" rx="4.5" ry="3" fill="#0a0a0f"/>
        <ellipse cx="25" cy="25" rx="2.5" ry="1.8" fill="#ffffff"/>
        <ellipse cx="39" cy="25" rx="4.5" ry="3" fill="#0a0a0f"/>
        <ellipse cx="39" cy="25" rx="2.5" ry="1.8" fill="#ffffff"/>
      </svg>
      <span class="sidebar-logo-text">Soulprint Docs</span>
    </div>
    <nav>
      <div class="sidebar-section">Getting Started</div>
      <a href="index.html">Overview</a><a href="quickstart.html">Quick Start</a>
      <div class="sidebar-section">Core Concepts</div>
      <a href="verify.html">Identity Verification</a><a href="trust-score.html">Trust Score (0‚Äì100)</a>
      <div class="sidebar-section">Integrations</div>
      <a href="mcp.html">MCP Servers</a><a href="openclaw.html">OpenClaw Bots</a>
      <div class="sidebar-section">Infrastructure</div>
      <a href="validator.html">Validator Node</a>
      <a href="api.html" class="active">REST API Reference</a>
      <div class="sidebar-section">Ecosystem</div>
      <a href="countries.html">Country Support</a>
    </nav>
  </aside>
  <main class="content">
    <div class="doc-hero">
      <h1>üì° REST API Reference</h1>
      <p class="subtitle">All endpoints exposed by a running Soulprint validator node (default: <code>http://localhost:4888</code>).</p>
    </div>

    <!-- GET /info -->
    <h2><span class="method method-get">GET</span> /info</h2>
    <p>Returns node status and network statistics. No authentication required.</p>
    <h4>Response</h4>
    <pre><code>{
  <span class="string">"peerId"</span>:             <span class="string">"12D3KooW..."</span>,
  <span class="string">"version"</span>:            <span class="string">"0.2.2"</span>,
  <span class="string">"httpPort"</span>:           <span class="keyword">4888</span>,
  <span class="string">"p2pPort"</span>:            <span class="keyword">6888</span>,
  <span class="string">"connectedPeers"</span>:     <span class="keyword">3</span>,
  <span class="string">"attestationsIssued"</span>: <span class="keyword">142</span>,
  <span class="string">"proofHashesStored"</span>:  <span class="keyword">891</span>,
  <span class="string">"uptime"</span>:             <span class="keyword">86400</span>,
  <span class="string">"multiaddrs"</span>: [<span class="string">"/ip4/0.0.0.0/tcp/6888/p2p/12D3KooW..."</span>]
}</code></pre>

    <!-- POST /verify -->
    <h2><span class="method method-post">POST</span> /verify</h2>
    <p>Verifies a Soulprint token and registers its proof hash for anti-replay. Returns the decoded token payload on success.</p>
    <h4>Request Body</h4>
    <pre><code>{ <span class="string">"token"</span>: <span class="string">"&lt;SPT token string&gt;"</span> }</code></pre>
    <h4>Response (200 OK)</h4>
    <pre><code>{
  <span class="string">"valid"</span>:        <span class="keyword">true</span>,
  <span class="string">"did"</span>:          <span class="string">"did:soulprint:abc123..."</span>,
  <span class="string">"score"</span>:        <span class="keyword">72</span>,
  <span class="string">"identity"</span>:    <span class="keyword">62</span>,
  <span class="string">"reputation"</span>:  <span class="keyword">10</span>,
  <span class="string">"country"</span>:     <span class="string">"CO"</span>,
  <span class="string">"credentials"</span>: [<span class="string">"email"</span>, <span class="string">"document"</span>, <span class="string">"face_match"</span>],
  <span class="string">"expiresAt"</span>:   <span class="string">"2026-08-24T10:00:00Z"</span>,
  <span class="string">"firstSeen"</span>:   <span class="string">"2026-02-24T10:00:00Z"</span>
}</code></pre>
    <h4>Response (400 ‚Äî expired or invalid)</h4>
    <pre><code>{ <span class="string">"valid"</span>: <span class="keyword">false</span>, <span class="string">"error"</span>: <span class="string">"token expired"</span> }</code></pre>
    <h4>Response (409 ‚Äî replay detected)</h4>
    <pre><code>{ <span class="string">"valid"</span>: <span class="keyword">false</span>, <span class="string">"error"</span>: <span class="string">"proof hash already registered (Sybil attempt)"</span> }</code></pre>

    <!-- POST /reputation/attest -->
    <h2><span class="method method-post">POST</span> /reputation/attest</h2>
    <p>Issue a behavioral attestation for a DID. Requires operator authorization.</p>
    <h4>Request Body</h4>
    <pre><code>{
  <span class="string">"did"</span>:        <span class="string">"did:soulprint:abc123..."</span>,
  <span class="string">"delta"</span>:      <span class="keyword">1</span>,              <span class="comment">// +1 (positive) or -1 (negative)</span>
  <span class="string">"reason"</span>:    <span class="string">"diverse_tool_use"</span>,  <span class="comment">// free-form label for audit log</span>
  <span class="string">"operatorSig"</span>: <span class="string">"&lt;signature&gt;"</span>   <span class="comment">// signed by operator key</span>
}</code></pre>
    <h4>Response (200 OK)</h4>
    <pre><code>{
  <span class="string">"ok"</span>:        <span class="keyword">true</span>,
  <span class="string">"did"</span>:       <span class="string">"did:soulprint:abc123..."</span>,
  <span class="string">"newScore"</span>: <span class="keyword">11</span>,
  <span class="string">"attestationId"</span>: <span class="string">"attest-uuid-..."</span>
}</code></pre>

    <!-- GET /reputation/:did -->
    <h2><span class="method method-get">GET</span> /reputation/:did</h2>
    <p>Returns the current bot reputation score for a DID.</p>
    <h4>Response</h4>
    <pre><code>{
  <span class="string">"did"</span>:            <span class="string">"did:soulprint:abc123..."</span>,
  <span class="string">"score"</span>:          <span class="keyword">12</span>,
  <span class="string">"attestations"</span>:  <span class="keyword">4</span>,        <span class="comment">// total attestations received</span>
  <span class="string">"positive"</span>:      <span class="keyword">3</span>,
  <span class="string">"negative"</span>:      <span class="keyword">1</span>,
  <span class="string">"lastUpdated"</span>:   <span class="string">"2026-02-24T14:00:00Z"</span>
}</code></pre>

    <!-- GET /proof-hash/:hash -->
    <h2><span class="method method-get">GET</span> /proof-hash/:hash</h2>
    <p>Checks if a proof hash has been registered (anti-replay lookup).</p>
    <h4>Response</h4>
    <pre><code>{
  <span class="string">"hash"</span>:       <span class="string">"sha3-abc123..."</span>,
  <span class="string">"registered"</span>: <span class="keyword">true</span>,
  <span class="string">"firstSeen"</span>:  <span class="string">"2026-02-24T10:00:00Z"</span>,
  <span class="string">"did"</span>:        <span class="string">"did:soulprint:abc123..."</span>   <span class="comment">// included if registered</span>
}</code></pre>

    <!-- Credential Validators -->
    <h2>Credential Validators <span style="font-size:0.7em;background:#7c6cf5;color:#fff;padding:2px 8px;border-radius:10px;margin-left:8px">v0.3.0</span></h2>

    <h3><span class="method method-post">POST</span> /credentials/email/start</h3>
    <p>Send a 6-digit OTP to an email address.</p>
    <pre><code><span class="comment">// Request</span>
{ <span class="string">"did"</span>: <span class="string">"did:soulprint:..."</span>, <span class="string">"email"</span>: <span class="string">"user@example.com"</span> }
<span class="comment">// Response</span>
{ <span class="string">"sessionId"</span>: <span class="string">"abc123..."</span>, <span class="string">"message"</span>: <span class="string">"OTP sent"</span>, <span class="string">"preview"</span>: <span class="string">"https://ethereal.email/..."</span> }</code></pre>

    <h3><span class="method method-post">POST</span> /credentials/email/verify</h3>
    <pre><code>{ <span class="string">"sessionId"</span>: <span class="string">"abc123..."</span>, <span class="string">"otp"</span>: <span class="string">"123456"</span> }
<span class="comment">// Response</span>
{ <span class="string">"credential"</span>: <span class="string">"EmailVerified"</span>, <span class="string">"did"</span>: <span class="string">"..."</span>, <span class="string">"attestation"</span>: { ... } }</code></pre>

    <h3><span class="method method-post">POST</span> /credentials/phone/start</h3>
    <p>Get a TOTP URI to scan with Google Authenticator / Authy / Aegis. No SMS.</p>
    <pre><code>{ <span class="string">"did"</span>: <span class="string">"..."</span>, <span class="string">"phone"</span>: <span class="string">"+573001234567"</span> }
<span class="comment">// Response</span>
{ <span class="string">"sessionId"</span>: <span class="string">"..."</span>, <span class="string">"totpUri"</span>: <span class="string">"otpauth://totp/Soulprint:..."</span>, <span class="string">"instructions"</span>: <span class="string">"Scan QR..."</span> }</code></pre>

    <h3><span class="method method-post">POST</span> /credentials/phone/verify</h3>
    <pre><code>{ <span class="string">"sessionId"</span>: <span class="string">"..."</span>, <span class="string">"code"</span>: <span class="string">"179941"</span> }
<span class="comment">// Response</span>
{ <span class="string">"credential"</span>: <span class="string">"PhoneVerified"</span>, <span class="string">"did"</span>: <span class="string">"..."</span>, <span class="string">"attestation"</span>: { ... } }</code></pre>

    <h3><span class="method method-get">GET</span> /credentials/github/start?did=...</h3>
    <p>Redirect to GitHub OAuth. Requires <code>GITHUB_CLIENT_ID</code> configured.</p>

    <h3><span class="method method-get">GET</span> /credentials/github/callback</h3>
    <p>OAuth callback. Issues <code>GitHubLinked</code> attestation after successful auth.</p>
    <pre><code>{ <span class="string">"credential"</span>: <span class="string">"GitHubLinked"</span>, <span class="string">"did"</span>: <span class="string">"..."</span>, <span class="string">"github"</span>: { <span class="string">"login"</span>: <span class="string">"manuelariasfz"</span> }, <span class="string">"attestation"</span>: { ... } }</code></pre>

    <h2>Error Codes</h2>
    <table>
      <tr><th>HTTP</th><th>Error</th><th>Meaning</th></tr>
      <tr><td>400</td><td><code>invalid_token</code></td><td>Token is malformed or signature invalid</td></tr>
      <tr><td>400</td><td><code>token_expired</code></td><td>Token has passed its expiresAt date</td></tr>
      <tr><td>401</td><td><code>unauthorized</code></td><td>Missing or invalid operator signature for attestation endpoints</td></tr>
      <tr><td>409</td><td><code>replay_detected</code></td><td>Proof hash already registered ‚Äî Sybil attempt blocked</td></tr>
      <tr><td>429</td><td><code>rate_limited</code></td><td>Too many requests ‚Äî retry after <code>Retry-After</code> header seconds</td></tr>
      <tr><td>503</td><td><code>node_syncing</code></td><td>Node is still syncing with the P2P network on startup</td></tr>
    </table>

    <h2>Rate Limits</h2>
    <table>
      <tr><th>Endpoint</th><th>Default limit</th><th>Notes</th></tr>
      <tr><td><code>GET /info</code></td><td>Unlimited</td><td>Health check endpoint</td></tr>
      <tr><td><code>POST /verify</code></td><td>100/min per IP</td><td>Configurable via <code>SOULPRINT_RATE_LIMIT</code></td></tr>
      <tr><td><code>POST /reputation/attest</code></td><td>60/min per operator key</td><td>Requires valid operator signature</td></tr>
      <tr><td><code>GET /reputation/:did</code></td><td>200/min per IP</td><td>Read-only, cached</td></tr>
      <tr><td><code>GET /proof-hash/:hash</code></td><td>200/min per IP</td><td>Read-only, cached</td></tr>
    </table>

    <h2>Blockchain Anchor</h2>
    <h3>GET /anchor/stats</h3>
    <p>Returns the status of the async blockchain backup.</p>
    <pre><code>GET /anchor/stats

Response:
{
  "nullifiersAnchored":  12,       <span class="comment">// total anchored to blockchain</span>
  "attestsAnchored":     47,
  "pendingNullifiers":   0,        <span class="comment">// in retry queue</span>
  "pendingAttests":      0,
  "blockchainConnected": true,     <span class="comment">// false = P2P-only mode</span>
  "lastAnchorTs":        1740000000000
}</code></pre>


    <h2>Governance</h2>
    <p>On-chain governance for PROTOCOL_HASH upgrades via <code>GovernanceModule.sol</code>.</p>

    <h3>GET /governance</h3>
    <pre><code>{
  "currentApprovedHash": "0xdfe1ccca...",
  "blockchainConnected": true,
  "activeProposals": 0,
  "hashHistory": ["0xdfe1ccca..."],
  "nodeCompatible": true
}</code></pre>

    <h3>GET /governance/proposals</h3>
    <p>List all active or approved-pending-timelock proposals.</p>

    <h3>GET /governance/proposal/:id</h3>
    <p>Full proposal detail including <code>timelockRemainingSeconds</code>.</p>

    <h3>POST /governance/propose</h3>
    <pre><code>{ "did": "did:key:z6Mk...", "newHash": "0x...", "rationale": "..." }
‚Üí { "txHash": "0x...", "proposalId": 0 }</code></pre>

    <h3>POST /governance/vote</h3>
    <pre><code>{ "proposalId": 0, "did": "did:key:z6Mk...", "approve": true }
‚Üí { "txHash": "0x...", "proposalId": 0, "approve": true }</code></pre>

    <h3>POST /governance/execute</h3>
    <pre><code>{ "proposalId": 0 }
‚Üí { "txHash": "0x...", "proposalId": 0, "executed": true }</code></pre>

  
    <!-- POST /challenge -->
    <h2 id="post-challenge"><code>POST /challenge</code> <span style="font-size:0.7em;background:#e63946;color:#fff;padding:2px 8px;border-radius:10px">v0.3.7</span></h2>
    <p>Peer integrity check via ZK challenge-response. Verifies that the peer is running unmodified ZK verification code.</p>
    <pre><code>POST /challenge
Content-Type: application/json

{
  "challenge_id": "a3f1b2c4...",     // random UUID
  "nonce": "deadbeef01234567...",    // 32-byte hex
  "issued_at": 1740000000,           // unix timestamp (TTL: 30s)
  "valid_proof": { ... },            // ZKProof ‚Äî must verify as true
  "invalid_proof": { ... }           // ZKProof mutated with nonce ‚Äî must verify as false
}

// Response 200
{
  "challenge_id": "a3f1b2c4...",
  "result_valid": true,
  "result_invalid": false,
  "verified_at": 1740000002,
  "node_did": "did:key:z6Mk...",
  "signature": "ed25519:abc..."
}

// Response 400 ‚Äî missing fields or expired challenge
// Response 403 ‚Äî peer rejected (used in POST /peers/register flow)</code></pre>

    <!-- POST /token/renew -->
    <h2 id="post-token-renew"><code>POST /token/renew</code> <span style="font-size:0.7em;background:#4ade80;color:#000;padding:2px 8px;border-radius:10px">v0.3.6</span></h2>
    <p>Auto-renew an SPT that is near expiry (&lt; 1h remaining) or recently expired (grace window: 7 days).</p>
    <pre><code>POST /token/renew
Content-Type: application/json

{ "spt": "&lt;current_spt_string&gt;" }

// Response 200
{
  "spt": "&lt;new_spt_string&gt;",
  "expires_in": 86400,
  "renewed": true,
  "method": "preemptive",   // or "grace_window"
  "old_expired": false,
  "node_did": "did:key:z6Mk..."
}

// Response 400 ‚Äî token still valid (&gt; 1h remaining), includes renew_after
// Response 401 ‚Äî token expired &gt; 7 days (full re-verification required)
// Response 403 ‚Äî DID not registered or score below floor
// Response 429 ‚Äî cooldown (60s between renewals per DID)</code></pre>

    <!-- DPoP -->
    <h2 id="dpop"><code>DPoP ‚Äî Demonstrating Proof of Possession</code> <span style="font-size:0.7em;background:#f59e0b;color:#000;padding:2px 8px;border-radius:10px">v0.3.8</span></h2>
    <p>Prevents stolen SPT abuse. Every request must carry a fresh signed proof. Without the private key, a stolen token is useless.</p>
    <p><strong>Header:</strong> <code>X-Soulprint-Proof: &lt;base64url-proof&gt;</code></p>
    <pre><code>// Proof payload (Ed25519 signed):
{
  "typ":      "soulprint-dpop",
  "method":   "POST",             // HTTP method ‚Äî must match request
  "url":      "https://...",      // exact URL ‚Äî must match request
  "nonce":    "a3f1b2...",        // 16 random bytes hex ‚Äî unique per request
  "iat":      1740000000,         // Unix timestamp ‚Äî expires in 300s
  "spt_hash": "sha256(spt)"       // bound to this specific token
}
// Serialized: base64url(JSON.stringify({ payload, signature, did }))

// Generate (client-side):
import { signDPoP, serializeDPoP } from "soulprint-core";
const proof  = signDPoP(privateKey, did, "POST", url, myToken);
const header = serializeDPoP(proof);

// Enable on server (soulprint-express):
app.use(soulprint({ minScore: 65, requireDPoP: true }));
// ‚Üí 401 { error: "dpop_required" } if proof header is missing

// Enable on MCP (soulprint-mcp):
server.use(soulprint({ minScore: 65, requireDPoP: true }));

// Attacks blocked: token theft ¬∑ replay ¬∑ URL MITM ¬∑ method MITM ¬∑
//   DID mismatch ¬∑ spt_hash mismatch ¬∑ expired proof ¬∑ malformed proof</code></pre>

    <!-- MCPRegistry -->
    <h2 id="mcpregistry"><code>MCPRegistry ‚Äî On-Chain Verified MCPs</code> <span style="font-size:0.7em;background:#06b6d4;color:#fff;padding:2px 8px;border-radius:10px">v0.3.9</span></h2>
    <p>Public registry of verified MCP servers on Base Sepolia. Agents can verify a server is legitimate before trusting it.</p>
    <p><strong>Contract:</strong> <code>0x59EA3c8f60ecbAe22B4c323A8dDc2b0BCd9D3C2a</code> (Base Sepolia)</p>

    <h3><span class="method method-get">GET</span> /mcps/verified</h3>
    <p>List all currently verified MCPs. Public, no authentication required.</p>
    <pre><code>GET /mcps/verified

// Response 200
{
  "total": 1,
  "registry": {
    "contract":   "0x59EA3c8f60ecbAe22B4c323A8dDc2b0BCd9D3C2a",
    "network":    "Base Sepolia (chainId: 84532)",
    "superAdmin": "0x0755...",
    "totalMCPs":  1,
    "explorer":   "https://sepolia.basescan.org/address/0x59EA..."
  },
  "mcps": [
    {
      "address":     "0x...",
      "name":        "MCP Colombia Hub",
      "url":         "https://npmjs.com/package/mcp-colombia-hub",
      "category":    "general",
      "description": "...",
      "verified_at": "2026-02-25T01:02:24.000Z",
      "badge":       "‚úÖ VERIFIED"
    }
  ]
}</code></pre>

    <h3><span class="method method-get">GET</span> /mcps/all</h3>
    <p>List all registered MCPs (verified + pending). Public.</p>

    <h3><span class="method method-get">GET</span> /mcps/status/:address</h3>
    <p>Check verification status of a specific MCP address.</p>
    <pre><code>GET /mcps/status/0x0755A3001F488da00088838c4a068dF7f883ad87

// Response 200
{
  "address":      "0x...",
  "name":         "MCP Colombia Hub",
  "registered":   true,
  "verified":     true,
  "registered_at": "2026-02-25T01:02:22.000Z",
  "verified_at":  "2026-02-25T01:02:24.000Z",
  "revoked_at":   null,
  "badge":        "‚úÖ VERIFIED by Soulprint"
}

// Response 404 ‚Äî not registered
{ "address": "0x...", "registered": false, "verified": false }</code></pre>

    <h3><span class="method method-post">POST</span> /admin/mcp/register <span style="font-size:0.8em;color:#888">(permissionless)</span></h3>
    <p>Register a new MCP on-chain. Anyone can register; verification requires admin approval.</p>
    <pre><code>POST /admin/mcp/register
Content-Type: application/json

{
  "ownerKey":    "0x&lt;private_key&gt;",   // signs the on-chain tx
  "address":     "0x&lt;mcp_address&gt;",
  "name":        "My Finance MCP",
  "url":         "https://my-mcp.example.com",
  "category":    "finance",            // finance|travel|jobs|ecommerce|general
  "description": "Provides Colombian financial data"
}

// Response 201
{
  "address":   "0x...",
  "name":      "My Finance MCP",
  "txHash":    "0x...",
  "explorer":  "https://sepolia.basescan.org/tx/0x...",
  "message":   "‚úÖ MCP registered. Contact Soulprint admin to verify.",
  "next_step": "POST /admin/mcp/verify with Bearer ADMIN_TOKEN"
}</code></pre>

    <h3><span class="method method-post">POST</span> /admin/mcp/verify <span style="font-size:0.8em;color:#e63946">üîê Admin only</span></h3>
    <p>Mark an MCP as verified on-chain. Requires <code>Authorization: Bearer ADMIN_TOKEN</code> + server-side <code>ADMIN_PRIVATE_KEY</code>.</p>
    <pre><code>POST /admin/mcp/verify
Authorization: Bearer &lt;ADMIN_TOKEN&gt;
Content-Type: application/json

{ "address": "0x&lt;mcp_address&gt;" }

// Response 200
{
  "address":  "0x...",
  "verified": true,
  "txHash":   "0x...",
  "explorer": "https://sepolia.basescan.org/tx/0x...",
  "message":  "‚úÖ MCP 0x... verified on-chain by Soulprint"
}

// Response 401 ‚Äî missing or wrong ADMIN_TOKEN
// Response 503 ‚Äî ADMIN_PRIVATE_KEY not configured on this node</code></pre>

    <h3><span class="method method-post">POST</span> /admin/mcp/revoke <span style="font-size:0.8em;color:#e63946">üîê Admin only</span></h3>
    <p>Revoke an MCP's verification. The reason is stored permanently on-chain.</p>
    <pre><code>POST /admin/mcp/revoke
Authorization: Bearer &lt;ADMIN_TOKEN&gt;
Content-Type: application/json

{ "address": "0x&lt;mcp_address&gt;", "reason": "Malicious behavior detected" }

// Response 200
{
  "address": "0x...",
  "revoked": true,
  "reason":  "Malicious behavior detected",
  "txHash":  "0x...",
  "message": "üö´ MCP 0x... revoked. Reason: 'Malicious behavior detected'"
}</code></pre>

    <!-- ProtocolThresholds -->
    <h2 id="protocol-thresholds"><code>ProtocolThresholds ‚Äî On-Chain Governance</code> <span style="font-size:0.7em;background:#a855f7;color:#fff;padding:2px 8px;border-radius:10px">v0.4.1</span></h2>
    <p>Protocol thresholds (SCORE_FLOOR, FACE_SIM_*, etc.) live on <code>ProtocolThresholds.sol</code> (Base Sepolia: <code>0xD8f78d65b35806101672A49801b57F743f2D2ab1</code>). Only the <code>superAdmin</code> can modify them; anyone can read. Validators load them at startup and refresh every 10 minutes.</p>

    <h3><span class="method method-get">GET</span> /protocol/thresholds</h3>
    <p>Returns all live protocol thresholds loaded from the blockchain.</p>
    <pre><code>GET /protocol/thresholds</code></pre>
    <p><strong>Response 200</strong></p>
    <pre><code>{
  "source":    "blockchain",
  "contract":  "0xD8f78d65b35806101672A49801b57F743f2D2ab1",
  "chain":     "Base Sepolia (chainId: 84532)",
  "thresholds": {
    "SCORE_FLOOR":            65,
    "VERIFIED_SCORE_FLOOR":   52,
    "MIN_ATTESTER_SCORE":     65,
    "FACE_SIM_DOC_SELFIE":    0.35,
    "FACE_SIM_SELFIE_SELFIE": 0.65,
    "DEFAULT_REPUTATION":     10,
    "IDENTITY_MAX":           80,
    "REPUTATION_MAX":         20
  },
  "last_loaded": "2026-02-24T22:00:00.000Z",
  "note": "Solo el superAdmin del contrato puede modificar estos valores on-chain"
}</code></pre>
    <p><code>source</code>: <code>"blockchain"</code> when loaded from chain, <code>"local_fallback"</code> if RPC is unreachable at node startup.</p>

    <h3>On-Chain Read (Solidity / ethers.js)</h3>
    <pre><code>const ABI = [
  "function getThreshold(string calldata name) external view returns (uint256)",
  "function getAll() external view returns (string[] memory names, uint256[] memory values)",
];
const contract = new ethers.Contract(
  "0xD8f78d65b35806101672A49801b57F743f2D2ab1", ABI, provider
);
const scoreFloor = await contract.getThreshold("SCORE_FLOOR");  // ‚Üí 65n
const [names, values] = await contract.getAll();                // ‚Üí 9 entries</code></pre>

    <h3>SuperAdmin ‚Äî Update Threshold</h3>
    <p>Only callable by the <code>superAdmin</code> wallet. Emits <code>ThresholdUpdated(key, oldValue, newValue, by, timestamp)</code>.</p>
    <pre><code>// Only superAdmin
const ABI_WRITE = [
  "function setThreshold(string calldata name, uint256 value) external",
];
const c = new ethers.Contract(CONTRACT_ADDRESS, ABI_WRITE, adminWallet);
await (await c.setThreshold("SCORE_FLOOR", 70)).wait();</code></pre>

    <h3>Canonical Values (v0.4.1)</h3>
    <table>
      <tr><th>Name</th><th>Value</th><th>Notes</th></tr>
      <tr><td><code>SCORE_FLOOR</code></td><td>65</td><td>Min score for protected services</td></tr>
      <tr><td><code>VERIFIED_SCORE_FLOOR</code></td><td>52</td><td>Min combined identity+reputation</td></tr>
      <tr><td><code>MIN_ATTESTER_SCORE</code></td><td>65</td><td>Min score to issue attestations</td></tr>
      <tr><td><code>FACE_SIM_DOC_SELFIE</code></td><td>350 (0.35)</td><td>Doc-photo vs selfie cosine similarity √ó1000</td></tr>
      <tr><td><code>FACE_SIM_SELFIE_SELFIE</code></td><td>650 (0.65)</td><td>Selfie vs selfie √ó1000</td></tr>
      <tr><td><code>DEFAULT_REPUTATION</code></td><td>10</td><td>Initial reputation for new identities</td></tr>
      <tr><td><code>IDENTITY_MAX</code></td><td>80</td><td>Max identity contribution to score</td></tr>
      <tr><td><code>REPUTATION_MAX</code></td><td>20</td><td>Max reputation contribution to score</td></tr>
    </table>

</main>
</div>
</body>
</html>
